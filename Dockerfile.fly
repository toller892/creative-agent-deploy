# Fly.io Dockerfile for AdCP Creative Agent
# syntax=docker/dockerfile:1.4

# Use AWS Public ECR to avoid Docker Hub rate limits
FROM public.ecr.aws/docker/library/python:3.12-slim

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install uv for package management
RUN pip install uv

WORKDIR /app

# Copy all files first
COPY . .

# Install dependencies (uv will create .venv)
RUN uv sync

# Add .venv to PATH
ENV PATH="/app/.venv/bin:$PATH"
ENV PYTHONUNBUFFERED=1

# Service port
ENV PORT=8080

# Expose port
EXPOSE 8080

# Run the HTTP server for production deployment
# Uses SSE transport on port 8080
CMD ["python", "-m", "creative_agent.http_server"]
